# 运行系统说明
#一、环境配置（终端进入环境后）
pip install -i https://pypi.douban.com/simple -r requirements.txt

如果使用工业相机则需要安装SDK，直接使用笔记本电脑的摄像头就不需要
下载链接：www.mindvision.com.cn/rjxz/list_12.aspx
软件为：迈德威视工业相机Windows系统SDK安装包V2.1.10.157(For Windows 10/7/8/8.1/Vista/XP)

1、开始需将Grad_design/yolodeepsort/deep_sort中的deep_sort.yaml文件中第二行的以下网络模型
ckpt.t7的路径改为相对路径

REID_CKPT: "C:\\Users\\hp\\Desktop\\s_dd\\detect_01\\Grad _design\\
yolodeepsort\\deep_sort\\deep_sort\\deep\\checkpoint\\ckpt.t7"

2、再将yolodeepsort/objtracker.py文件中的第八行改为deep_sort.yaml文件的相对路径
cfg.merge_from_file(r"C:\Users\hp\Desktop\s_dd\detect_01\Grad _design\yolodeepsort\deep_sort\deep_sort.yaml")

3、右键设置s_dd、Grad _design以及yolodeepsort文件，将目录标记为源根root

运行主程序为Grad _design中的main_Interface.py
由于时间有限，目前存在直接运行有问题，但选择调试则可以运行
所以通过点击调试可以查看系统运行效果

#二、报错解决方法：
1、若在终端无法进入环境的话，设置终端为相应的cmd.exe路径
C:\Windows\System32\cmd.exe
我们自己是使用的anaconda创建的虚拟环境

2、初次使用环境若报错...5md.dll文件（不记得具体叫什么了，但报错的话会弹出名称）
需要初始化一下：
就是在环境目录下搜索该名称的dll文件，删除这些文件即可

3、安装torch后，大概可能出现upsample的错误
可以直接百度搜索该错误，具体是只要删除一个参数即可

# 项目不全，因为数据集和参数过大
# 总体
本系统为基于深度学习的人员密度检测系统，对目标检测、行人跟踪等多个方面进行了综合性的研究，通过摄像头监控或者分析视频的方式，对于人员进行检测分析，当出现高风险情况予以及时的语音播报和高风险人数的实时统计，并最终存储入数据库。目标检测选用了 coco 数据集中的 person 类别通过 YOLOv3算法进行人员检测；人员跟踪选择了清华大学拍摄的 Market-1501 数据集通过DeepSort 算法训练模型进而实现目标跟踪；数据库是采用的轻量型的嵌入式关系数据库管理系统 SQLite 进行数据存储。并利用 Pyqt 和 pyttxs 实现了实时语音播报功能。本系统以达到对场所中的人员密度检测、人员跟踪、测距预警等的作用。
# 具体功能介绍
（1) 选择检测对象：选择使用摄像头设备或传入视频文件进行检测。

(2) 开始检测：摄像头图像实时检测或视频文件进行逐帧检测。

(3) 暂停检测：视频文件停止向下一帧检测，摄像头停止在当前画面不往下更新。

(4) 继续检测：视频文件从暂停时刻继续往下检测，摄像头更新获取图像进行检测。

(5) 停止检测：中止检测回到初试状态，可以重新选取视频文件或选取摄像头进行检测。

(6) 行人检测跟踪：对行人进行跟踪标识，可选择显示跟踪情况或者选择不显示跟踪情况。

(7) 拍摄图片：拍摄当前帧的图像，方便观察当前帧行人情况及高风险人群情况。

(8) 语音播报：开启播报时有高风险密集情况予以及时播报提醒，关闭时无提醒。

(9) 统计结果：将当前视频帧中的行人总数、高风险人数、当前时间及检测状态及时输出反馈，方便操作人员直观的看到数据。

(10)数据输出：根据用户需要选择开始将检测数据及图片存储进数据库及停止存储进数据库。

(11)查看数据：能够按天查看当天存储的数据情况及图片记录

# 具体实现
(1) 图像显示模块：该模块部分是一个图像输出框组成，当操作人员选择了离线视频或打开了摄像头开始检测后，输出框会逐帧实时更新显示视频或摄像头的图像。其中包含了检测出行人并由检测框框选出的结果。而且后端的行人计数划线标注高风险及低风险距离。
(2) 图片拍摄：该模块部分为另一个图像输出框，当点击拍摄照片控件时，定格当前的图片，便于操作人员将此刻的状态与之后进行对比或对于当前情况下的场景状况进行定格仔细观察分析等情况，可再次点击覆盖上一次定格图。
(3) 语音播报模块：该模块是在视频中出现的高风险情况予以播报语音提醒，界面附有打开播报和停止播报的按钮，可选择在系统需要开启播报的时候打开，不使用的时候予以停止。
(4) 实时数据显示：该模块是实时的对于视频中的高风险人数进行计算，输出显示在数据显示模块的表格中。展示的是当前时刻图中的行人总数、高峰线人数、时间、状态是否为高风险，可以直观的让操作人员掌握现在的情况。
(5) 数据库操作：该模块用户可以进行开始存储数据、停止存储数据和查看数据库的操作。

(1) 行人目标检测模块：该模块是使用 YOLOv3 进行行人目标识别的模块，通过coco 数据集的 person 类进行训练，将每一帧视频进行分析识别。将识别到的行人用检测框框选出来，展示给操作人员。
(2) 行人跟踪处理模块：该模块是使用了 DeepSort 算法对行人的行走轨迹进行跟踪计算及每个行人的特征信息进行存储分析，对于每个行人赋予一个单独的ID 标号，同一行人的 ID 标号显示会一直跟踪伴随其运动，在所设置的最大寿命（也可称最大保留帧数）内，可以一直标记同一行人。
(3) 行人划线计数模块：该模块是对于目标检测出的行人由检测框框选出位置后，通过欧氏距离算法计算行人间距离，其中小于高风险阈值的距离用红线相连标注，大于高风险阈值小于低风险阈值用黄线连线标注。
(4) 数据存储模块：该模块是对于行人计数模块得出的数据结果和图片结果进行存储入数据库操作。所存储的数据为操作人员点击开始存储到点击停止存储为止的数据，可根据所需保存所需时间段的数据。当需要查看数据库中的数据时可点击查看数据库跳转至数据显示界面。
## 数据窗口
(1) 数据日历：该模块是一个日历样式的选择框，根据操作人员所点击的日期而改变数据显示模块和图片记录模块。
(2) 数据显示：当操作人员在数据日历选择了日期后，该模块显示该日所进行存储的数据记录，包含行人总数、高风险人数、检测时间、状态显示的信息。
(3) 图片记录：当操作人员点击数据显示中的某条数据时，显示对应时刻抓取存储的图片信息。
